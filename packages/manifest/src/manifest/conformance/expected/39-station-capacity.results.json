{
  "testCases": [
    {
      "name": "assign task to station succeeds when below capacity",
      "setup": {
        "createInstance": {
          "entity": "Station",
          "data": {
            "id": "station-1",
            "tenantId": "tenant-1",
            "name": "Cold Prep",
            "capacity": 3,
            "currentTasks": 1,
            "isActive": true
          }
        }
      },
      "command": {
        "name": "assignTask",
        "entityName": "Station",
        "instanceId": "station-1",
        "input": { "taskId": "task-10" }
      },
      "expectedResult": {
        "success": true,
        "emittedEvents": [
          {
            "name": "StationTaskAssigned",
            "channel": "kitchen.station.task.assigned",
            "payload": {
              "stationId": "station-1",
              "taskId": "task-10",
              "timestamp": 1000000000000
            },
            "timestamp": 1000000000000
          }
        ]
      },
      "expectedInstanceState": {
        "id": "station-1",
        "tenantId": "tenant-1",
        "name": "Cold Prep",
        "capacity": 3,
        "currentTasks": 2,
        "isActive": true
      }
    },
    {
      "name": "assign task to station fails when at capacity",
      "setup": {
        "createInstance": {
          "entity": "Station",
          "data": {
            "id": "station-2",
            "tenantId": "tenant-1",
            "name": "Full Station",
            "capacity": 2,
            "currentTasks": 2,
            "isActive": true
          }
        }
      },
      "command": {
        "name": "assignTask",
        "entityName": "Station",
        "instanceId": "station-2",
        "input": { "taskId": "task-11" }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'assignTask'",
        "emittedEvents": []
      }
    },
    {
      "name": "assign task to station fails when inactive",
      "setup": {
        "createInstance": {
          "entity": "Station",
          "data": {
            "id": "station-3",
            "tenantId": "tenant-1",
            "name": "Inactive Station",
            "capacity": 5,
            "currentTasks": 0,
            "isActive": false
          }
        }
      },
      "command": {
        "name": "assignTask",
        "entityName": "Station",
        "instanceId": "station-3",
        "input": { "taskId": "task-12" }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'assignTask'",
        "emittedEvents": []
      }
    },
    {
      "name": "remove task from station succeeds when tasks exist",
      "setup": {
        "createInstance": {
          "entity": "Station",
          "data": {
            "id": "station-4",
            "tenantId": "tenant-1",
            "name": "Garnish Station",
            "capacity": 3,
            "currentTasks": 2,
            "isActive": true
          }
        }
      },
      "command": {
        "name": "removeTask",
        "entityName": "Station",
        "instanceId": "station-4",
        "input": { "taskId": "task-20" }
      },
      "expectedResult": {
        "success": true,
        "emittedEvents": [
          {
            "name": "StationTaskRemoved",
            "channel": "kitchen.station.task.removed",
            "payload": {
              "stationId": "station-4",
              "taskId": "task-20",
              "timestamp": 1000000000000
            },
            "timestamp": 1000000000000
          }
        ]
      },
      "expectedInstanceState": {
        "id": "station-4",
        "tenantId": "tenant-1",
        "name": "Garnish Station",
        "capacity": 3,
        "currentTasks": 1,
        "isActive": true
      }
    },
    {
      "name": "remove task from station fails when no tasks exist",
      "setup": {
        "createInstance": {
          "entity": "Station",
          "data": {
            "id": "station-5",
            "tenantId": "tenant-1",
            "name": "Empty Station",
            "capacity": 3,
            "currentTasks": 0,
            "isActive": true
          }
        }
      },
      "command": {
        "name": "removeTask",
        "entityName": "Station",
        "instanceId": "station-5",
        "input": { "taskId": "task-21" }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'removeTask'",
        "emittedEvents": []
      }
    },
    {
      "name": "update station capacity succeeds with valid value",
      "setup": {
        "createInstance": {
          "entity": "Station",
          "data": {
            "id": "station-6",
            "tenantId": "tenant-1",
            "name": "Expandable Station",
            "capacity": 2,
            "currentTasks": 1,
            "isActive": true
          }
        }
      },
      "command": {
        "name": "updateCapacity",
        "entityName": "Station",
        "instanceId": "station-6",
        "input": { "newCapacity": 5 }
      },
      "expectedResult": {
        "success": true,
        "emittedEvents": [
          {
            "name": "StationCapacityUpdated",
            "channel": "kitchen.station.capacity.updated",
            "payload": {
              "stationId": "station-6",
              "newCapacity": 5,
              "timestamp": 1000000000000
            },
            "timestamp": 1000000000000
          }
        ]
      },
      "expectedInstanceState": {
        "id": "station-6",
        "tenantId": "tenant-1",
        "name": "Expandable Station",
        "capacity": 5,
        "currentTasks": 1,
        "isActive": true
      }
    }
  ]
}
