{
  "testCases": [
    {
      "name": "claim succeeds with open task and constraint severity evaluated",
      "setup": {
        "createInstance": {
          "entity": "PrepTask",
          "data": {
            "id": "task-1",
            "tenantId": "tenant-1",
            "name": "Low Priority Task",
            "status": "open",
            "claimedBy": "",
            "claimedAt": 0,
            "stationId": "",
            "priority": 3,
            "quantityTotal": 10,
            "quantityCompleted": 0,
            "eventId": "event-1",
            "dueByTime": "15:00"
          }
        }
      },
      "command": {
        "name": "claim",
        "entityName": "PrepTask",
        "instanceId": "task-1",
        "input": { "stationId": "station-1", "userId": "user-1" }
      },
      "expectedResult": {
        "success": true,
        "emittedEvents": [
          {
            "name": "PrepTaskClaimed",
            "channel": "kitchen.task.claimed",
            "payload": {
              "taskId": "task-1",
              "claimedBy": "user-1",
              "stationId": "station-1",
              "timestamp": 1000000000000
            },
            "timestamp": 1000000000000
          }
        ]
      },
      "expectedInstanceState": {
        "id": "task-1",
        "tenantId": "tenant-1",
        "name": "Low Priority Task",
        "status": "in_progress",
        "claimedBy": "user-1",
        "claimedAt": 1000000000000,
        "stationId": "station-1",
        "priority": 3,
        "quantityTotal": 10,
        "quantityCompleted": 0,
        "eventId": "event-1",
        "dueByTime": "15:00"
      }
    },
    {
      "name": "complete with partial quantity succeeds with warning",
      "setup": {
        "createInstance": {
          "entity": "PrepTask",
          "data": {
            "id": "task-2",
            "tenantId": "tenant-1",
            "name": "Partial Complete Task",
            "status": "in_progress",
            "claimedBy": "user-1",
            "claimedAt": 999999999000,
            "stationId": "station-1",
            "priority": 3,
            "quantityTotal": 10,
            "quantityCompleted": 0,
            "eventId": "event-1",
            "dueByTime": "15:00"
          }
        }
      },
      "command": {
        "name": "complete",
        "entityName": "PrepTask",
        "instanceId": "task-2",
        "input": { "quantity": 5, "userId": "user-1" }
      },
      "expectedResult": {
        "success": true,
        "emittedEvents": [
          {
            "name": "PrepTaskCompleted",
            "channel": "kitchen.task.completed",
            "payload": {
              "taskId": "task-2",
              "completedBy": "user-1",
              "quantity": 5,
              "timestamp": 1000000000000
            },
            "timestamp": 1000000000000
          }
        ]
      },
      "expectedInstanceState": {
        "id": "task-2",
        "tenantId": "tenant-1",
        "name": "Partial Complete Task",
        "status": "done",
        "claimedBy": "user-1",
        "claimedAt": 999999999000,
        "stationId": "station-1",
        "priority": 3,
        "quantityTotal": 10,
        "quantityCompleted": 5,
        "eventId": "event-1",
        "dueByTime": "15:00"
      }
    }
  ]
}
