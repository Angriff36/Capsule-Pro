{
  "testCases": [
    {
      "name": "reserve inventory succeeds when sufficient stock available",
      "setup": {
        "createInstance": {
          "entity": "InventoryItem",
          "data": {
            "id": "item-1",
            "tenantId": "tenant-1",
            "name": "Tomatoes",
            "quantityOnHand": 100,
            "quantityReserved": 20,
            "parLevel": 50,
            "costPerUnit": 2.5,
            "locationId": "storage-1",
            "isActive": true
          }
        }
      },
      "command": {
        "name": "reserve",
        "entityName": "InventoryItem",
        "instanceId": "item-1",
        "input": { "quantity": 30, "eventId": "event-1" }
      },
      "expectedResult": {
        "success": true,
        "emittedEvents": [
          {
            "name": "InventoryReserved",
            "channel": "kitchen.inventory.reserved",
            "payload": {
              "itemId": "item-1",
              "quantity": 30,
              "eventId": "event-1",
              "timestamp": 1000000000000
            },
            "timestamp": 1000000000000
          }
        ]
      },
      "expectedInstanceState": {
        "id": "item-1",
        "tenantId": "tenant-1",
        "name": "Tomatoes",
        "quantityOnHand": 100,
        "quantityReserved": 50,
        "parLevel": 50,
        "costPerUnit": 2.5,
        "locationId": "storage-1",
        "isActive": true
      }
    },
    {
      "name": "reserve inventory fails when insufficient stock available",
      "setup": {
        "createInstance": {
          "entity": "InventoryItem",
          "data": {
            "id": "item-2",
            "tenantId": "tenant-1",
            "name": "Rare Item",
            "quantityOnHand": 50,
            "quantityReserved": 40,
            "parLevel": 100,
            "costPerUnit": 10,
            "locationId": "storage-1",
            "isActive": true
          }
        }
      },
      "command": {
        "name": "reserve",
        "entityName": "InventoryItem",
        "instanceId": "item-2",
        "input": { "quantity": 20, "eventId": "event-1" }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'reserve'",
        "emittedEvents": []
      }
    },
    {
      "name": "consume inventory succeeds when sufficient stock on hand",
      "setup": {
        "createInstance": {
          "entity": "InventoryItem",
          "data": {
            "id": "item-3",
            "tenantId": "tenant-1",
            "name": "Flour",
            "quantityOnHand": 100,
            "quantityReserved": 20,
            "parLevel": 50,
            "costPerUnit": 1.5,
            "locationId": "storage-1",
            "isActive": true
          }
        }
      },
      "command": {
        "name": "consume",
        "entityName": "InventoryItem",
        "instanceId": "item-3",
        "input": { "quantity": 25, "lotId": "lot-1" }
      },
      "expectedResult": {
        "success": true,
        "emittedEvents": [
          {
            "name": "InventoryConsumed",
            "channel": "kitchen.inventory.consumed",
            "payload": {
              "itemId": "item-3",
              "quantity": 25,
              "lotId": "lot-1",
              "timestamp": 1000000000000
            },
            "timestamp": 1000000000000
          }
        ]
      },
      "expectedInstanceState": {
        "id": "item-3",
        "tenantId": "tenant-1",
        "name": "Flour",
        "quantityOnHand": 75,
        "quantityReserved": 0,
        "parLevel": 50,
        "costPerUnit": 1.5,
        "locationId": "storage-1",
        "isActive": true
      }
    },
    {
      "name": "consume inventory fails when insufficient stock on hand",
      "setup": {
        "createInstance": {
          "entity": "InventoryItem",
          "data": {
            "id": "item-4",
            "tenantId": "tenant-1",
            "name": "Saffron",
            "quantityOnHand": 5,
            "quantityReserved": 0,
            "parLevel": 10,
            "costPerUnit": 50,
            "locationId": "storage-1",
            "isActive": true
          }
        }
      },
      "command": {
        "name": "consume",
        "entityName": "InventoryItem",
        "instanceId": "item-4",
        "input": { "quantity": 10, "lotId": "lot-1" }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'consume'",
        "emittedEvents": []
      }
    },
    {
      "name": "restock inventory succeeds with positive quantity",
      "setup": {
        "createInstance": {
          "entity": "InventoryItem",
          "data": {
            "id": "item-5",
            "tenantId": "tenant-1",
            "name": "Sugar",
            "quantityOnHand": 10,
            "quantityReserved": 0,
            "parLevel": 50,
            "costPerUnit": 1.0,
            "locationId": "storage-1",
            "isActive": true
          }
        }
      },
      "command": {
        "name": "restock",
        "entityName": "InventoryItem",
        "instanceId": "item-5",
        "input": { "quantity": 50, "costPerUnit": 1.2 }
      },
      "expectedResult": {
        "success": true,
        "emittedEvents": [
          {
            "name": "InventoryRestocked",
            "channel": "kitchen.inventory.restocked",
            "payload": {
              "itemId": "item-5",
              "quantity": 50,
              "costPerUnit": 1.2,
              "timestamp": 1000000000000
            },
            "timestamp": 1000000000000
          }
        ]
      },
      "expectedInstanceState": {
        "id": "item-5",
        "tenantId": "tenant-1",
        "name": "Sugar",
        "quantityOnHand": 60,
        "quantityReserved": 0,
        "parLevel": 50,
        "costPerUnit": 1.2,
        "locationId": "storage-1",
        "isActive": true
      }
    },
    {
      "name": "restock inventory fails with zero or negative quantity",
      "setup": {
        "createInstance": {
          "entity": "InventoryItem",
          "data": {
            "id": "item-6",
            "tenantId": "tenant-1",
            "name": "Salt",
            "quantityOnHand": 10,
            "quantityReserved": 0,
            "parLevel": 20,
            "costPerUnit": 0.5,
            "locationId": "storage-1",
            "isActive": true
          }
        }
      },
      "command": {
        "name": "restock",
        "entityName": "InventoryItem",
        "instanceId": "item-6",
        "input": { "quantity": 0, "costPerUnit": 0.5 }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'restock'",
        "emittedEvents": []
      }
    },
    {
      "name": "waste inventory succeeds with sufficient stock",
      "setup": {
        "createInstance": {
          "entity": "InventoryItem",
          "data": {
            "id": "item-7",
            "tenantId": "tenant-1",
            "name": "Dairy Product",
            "quantityOnHand": 50,
            "quantityReserved": 10,
            "parLevel": 30,
            "costPerUnit": 3.0,
            "locationId": "storage-1",
            "isActive": true
          }
        }
      },
      "command": {
        "name": "waste",
        "entityName": "InventoryItem",
        "instanceId": "item-7",
        "input": { "quantity": 5, "reason": "Expired", "lotId": "lot-123" }
      },
      "expectedResult": {
        "success": true,
        "emittedEvents": [
          {
            "name": "InventoryWasted",
            "channel": "kitchen.inventory.wasted",
            "payload": {
              "itemId": "item-7",
              "quantity": 5,
              "reason": "Expired",
              "lotId": "lot-123",
              "timestamp": 1000000000000
            },
            "timestamp": 1000000000000
          }
        ]
      },
      "expectedInstanceState": {
        "id": "item-7",
        "tenantId": "tenant-1",
        "name": "Dairy Product",
        "quantityOnHand": 45,
        "quantityReserved": 5,
        "parLevel": 30,
        "costPerUnit": 3.0,
        "locationId": "storage-1",
        "isActive": true
      }
    }
  ]
}
