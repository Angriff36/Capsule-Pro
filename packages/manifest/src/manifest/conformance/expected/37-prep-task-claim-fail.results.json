{
  "testCases": [
    {
      "name": "claim prep task fails when task is already in progress",
      "setup": {
        "createInstance": {
          "entity": "PrepTask",
          "data": {
            "id": "task-1",
            "tenantId": "tenant-1",
            "name": "In Progress Task",
            "status": "in_progress",
            "claimedBy": "user-2",
            "claimedAt": 999999999000,
            "stationId": "station-1",
            "priority": 3,
            "quantityTotal": 10,
            "quantityCompleted": 0,
            "eventId": "event-1"
          }
        }
      },
      "command": {
        "name": "claim",
        "entityName": "PrepTask",
        "instanceId": "task-1",
        "input": { "stationId": "station-1", "userId": "user-1" }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'claim'",
        "emittedEvents": []
      }
    },
    {
      "name": "claim prep task fails when task is completed",
      "setup": {
        "createInstance": {
          "entity": "PrepTask",
          "data": {
            "id": "task-2",
            "tenantId": "tenant-1",
            "name": "Completed Task",
            "status": "done",
            "claimedBy": "user-1",
            "claimedAt": 999999999000,
            "stationId": "station-1",
            "priority": 3,
            "quantityTotal": 10,
            "quantityCompleted": 10,
            "eventId": "event-1"
          }
        }
      },
      "command": {
        "name": "claim",
        "entityName": "PrepTask",
        "instanceId": "task-2",
        "input": { "stationId": "station-1", "userId": "user-2" }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'claim'",
        "emittedEvents": []
      }
    },
    {
      "name": "complete prep task fails when user is not claimer",
      "setup": {
        "createInstance": {
          "entity": "PrepTask",
          "data": {
            "id": "task-3",
            "tenantId": "tenant-1",
            "name": "Not My Task",
            "status": "in_progress",
            "claimedBy": "user-1",
            "claimedAt": 999999999000,
            "stationId": "station-1",
            "priority": 3,
            "quantityTotal": 10,
            "quantityCompleted": 0,
            "eventId": "event-1"
          }
        }
      },
      "command": {
        "name": "complete",
        "entityName": "PrepTask",
        "instanceId": "task-3",
        "input": { "quantity": 10, "userId": "user-2" }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'complete'",
        "emittedEvents": []
      }
    },
    {
      "name": "complete prep task fails when task is not in progress",
      "setup": {
        "createInstance": {
          "entity": "PrepTask",
          "data": {
            "id": "task-4",
            "tenantId": "tenant-1",
            "name": "Open Task",
            "status": "open",
            "claimedBy": "",
            "claimedAt": 0,
            "stationId": "",
            "priority": 3,
            "quantityTotal": 10,
            "quantityCompleted": 0,
            "eventId": "event-1"
          }
        }
      },
      "command": {
        "name": "complete",
        "entityName": "PrepTask",
        "instanceId": "task-4",
        "input": { "quantity": 10, "userId": "user-1" }
      },
      "expectedResult": {
        "success": false,
        "error": "Guard condition failed for command 'complete'",
        "emittedEvents": []
      }
    }
  ]
}
