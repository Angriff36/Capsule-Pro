# Progress: Recipes & Menu Overhaul

Feature ID: 002
Constitution: 1.0.0

## Completed Tasks

- [x] T001 Create recipe-edit-modal component shell - 336bc67d8
- [x] T002 Create shared UI components (skeleton, stars, time badges) - 6ca5b59bc
- [x] T003 Quality checkpoint - Phase 1 Setup - verified
- [x] T004 Implement updateRecipe server action with versioning - 78406a045
- [x] T005 Fetch recipe data for edit modal - 39b90aeab
- [x] T006 Wire edit modal to recipe cards - e530749a8
- [x] T007 Implement ingredient management in edit modal - 03230e5f7

## Current Task

All tasks complete

## Learnings

- Sheet component in design-system uses Dialog primitive from radix-ui
- createRecipe action expects: name, category, description, tags, yieldQuantity, yieldUnit, yieldDescription, prepTimeMinutes, cookTimeMinutes, restTimeMinutes, difficultyLevel
- Pre-existing tsconfig issue: declarationMap without declaration/composite option - infrastructure debt, not blocking
- Components export: SkeletonCard, SkeletonCardGrid, DifficultyStars, DifficultyRating, TimeBadges, TotalTimeBadge
- Pre-existing lint errors in apps/api and vitest.config.ts do not affect recipe components
- updateRecipe follows same pattern as createRecipe: verifies tenant ownership, creates new version, soft-deletes old ingredients/steps, inserts new ones
- Versioning pattern: query MAX(version_number) + 1 for new version, keep old versions for history
- getRecipeForEdit returns: recipe base data, latest version details, ingredients with names and units, steps with order
- RecipeForEdit type exported for form pre-population in edit modal
- Edit modal wiring uses CustomEvent pattern to communicate from server component (page.tsx) to client component (recipes-page-client.tsx)
- Created RecipeEditButton client component to dispatch edit-recipe event when clicked
- RecipesPageClient listens for edit-recipe events, fetches recipe data via getRecipeForEdit, and opens RecipeEditModal
- Ingredient management added to RecipeEditModal:
  - Ingredient type with: id?, name, quantity, unit, notes?
  - IngredientRow component with reorder (up/down), update, and remove functionality
  - State management: ingredients array initialized from recipe.ingredients
  - Form submission: ingredients serialized to JSON string in FormData
  - UI: Add Ingredient button, ingredient rows with quantity/unit/name inputs, Ã— remove button
  - Reorder: Simple up/down arrow buttons (more accessible than drag-and-drop)

### Verification: T003 [VERIFY] Quality checkpoint - Phase 1 Setup
- Status: PASS
- Fixed lint issues in recipe-edit-modal.tsx:
  - Extracted TagChip and TimeInput helper components to reduce cognitive complexity (16->11)
  - Added block statement to early return (lint/style/useBlockStatements)
  - Moved ternary expressions to computed variables
- Commands: biome check on components directory passed (0 errors)
- TypeScript: Pre-existing TS5069 error in tsconfig.json (declarationMap) unrelated to new code
- All 4 new component files exist and are lint-clean

## Next

All Phase 1 tasks complete

## Technical Debt Tracking

| Debt | Future Fix | Tracking |
|------|------------|----------|
| Raw SQL in actions.ts | Use Prisma CRUD | Plan.md |
| No Zod validation | Add schema validation | Phase 3+ |
| No optimistic updates | Add for drag-drop | Future |
